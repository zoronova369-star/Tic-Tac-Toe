<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tic-Tac-Toe Web</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <h1>Tic Tac Toe</h1>
    <div id="mode-select">
        <button onclick="startGame('2p')">2 Player</button>
        <button onclick="startGame('cpu')">Play vs CPU</button>
    </div>

    <div id="game" class="hidden">
        <div id="board" class="board"></div>
        <p id="status"></p>
        <button onclick="reset()">Restart</button>
    </div>

<script>
let board = Array(9).fill(' ');
let current = 'X';
let mode = '2p';
let human = 'X';
let cpu = 'O';
let playing = true;

function startGame(selectedMode) {
    mode = selectedMode;
    document.getElementById('mode-select').classList.add('hidden');
    document.getElementById('game').classList.remove('hidden');
    renderBoard();
}

function renderBoard() {
    const boardDiv = document.getElementById('board');
    boardDiv.innerHTML = '';
    board.forEach((cell, i) => {
        const cellDiv = document.createElement('div');
        cellDiv.className = 'cell';
        cellDiv.textContent = cell;
        cellDiv.onclick = () => handleMove(i);
        boardDiv.appendChild(cellDiv);
    });
}

async function handleMove(index) {
    if (!playing || board[index] !== ' ') return;
    board[index] = current;
    renderBoard();

    let res = await fetch("/check", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ board })
    });
    let data = await res.json();

    if (data.winner || data.tie) return endGame(data);

    current = current === 'X' ? 'O' : 'X';

    if (mode === 'cpu' && current === cpu) {
        document.getElementById('status').textContent = "CPU thinking...";
        const moveRes = await fetch("/cpu_move", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({ board, cpu })
        });
        const moveData = await moveRes.json();
        board[moveData.move] = cpu;
        renderBoard();

        const checkRes = await fetch("/check", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({ board })
        });
        const checkData = await checkRes.json();
        if (checkData.winner || checkData.tie) return endGame(checkData);

        current = human;
        document.getElementById('status').textContent = "Your turn.";
    }
}

function endGame(result) {
    playing = false;
    if (result.winner) {
        document.getElementById('status').textContent = `ðŸŽ‰ ${result.winner} wins!`;
    } else {
        document.getElementById('status').textContent = "It's a tie!";
    }
}

function reset() {
    board = Array(9).fill(' ');
    current = 'X';
    playing = true;
    document.getElementById('status').textContent = '';
    renderBoard();
}
</script>
</body>
</html>
